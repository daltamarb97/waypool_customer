{"version":3,"sources":["../../src/pages/p-createcrew/createcrew.module.ts","../../src/pages/p-createcrew/createcrew.ts"],"names":[],"mappings":"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","file":"41.js","sourcesContent":["\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CreateCrewPage } from './createcrew';\n \n@NgModule({\n  declarations: [\n    CreateCrewPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CreateCrewPage),\n  ],\n  exports: [\n    CreateCrewPage\n  ]\n})\nexport class CreateCrewPageModule {}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/p-createcrew/createcrew.module.ts","import { Component } from '@angular/core';\nimport { NavController, ViewController, NavParams, ToastController, IonicPage, AlertController } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { SignUpService } from '../../services/signup.services';\nimport { sendCoordsService } from '../../services/sendCoords.service';\nimport { AngularFireAuth } from 'angularfire2/auth';\nimport { sendUsersService } from '../../services/sendUsers.service';\nimport { geofireService } from '../../services/geoFire.service';\nimport { instancesService } from '../../services/instances.service';\nimport { Subject, onErrorResumeNext } from 'rxjs';\nimport { DriverGeofireService } from '../../services/d-geofire.services';\n\n@IonicPage()\n\n@Component({\n  selector: 'page-createcrew',\n  templateUrl: 'createcrew.html'\n})\nexport class CreateCrewPage {\n\n  startHour:any;\n  userId:any;\n  origin:any;\n  destination:any;\n  latOr:any;\n  lngOr:any;\n  latDest:any;\n  lngDest:any;\n  admin = {};\n  pointsAlongRoute = [];\n  indexesOfPointsAlongRoute = [];\n  count:any = 0;\n  constructor(public navCtrl: NavController, public sendUsersService:sendUsersService,public toastCtrl: ToastController,public viewCtrl: ViewController,private afDB: AngularFireDatabase, public SignUpService: SignUpService, public sendCoordsService: sendCoordsService,public navParams: NavParams,public AngularFireAuth: AngularFireAuth, private geoFireService: geofireService, public instances: instancesService, public alertCtrl: AlertController, private geofireServicesDr: DriverGeofireService) {\n      this.userId = this.AngularFireAuth.auth.currentUser.uid;\n\n      // Getting info for creating crew in DB\n      this.afDB.database.ref('/usersTest/' + this.userId).once('value').then((snap)=>{\n        if(snap.val()){\n          this.admin = {\n            city: snap.val().city,\n            company: snap.val().company,\n            name: snap.val().name,\n            lastname: snap.val().lastname,\n            phone: snap.val().phone,\n            userId: snap.val().userId,\n            verifiedPerson: snap.val().verifiedPerson,\n          }\n          this.origin = snap.val().trips.origin[0]\n          this.destination = snap.val().trips.destination[0]\n\n        }\n        \n      })\n\n\n\n    this.latOr = this.navParams.get('latOr');\n    this.lngOr = this.navParams.get('lngOr');\n    this.latDest = this.navParams.get('latDest');\n    this.lngDest = this.navParams.get('lngDest');\n    this.pointsAlongRoute = this.navParams.get('pointsAlongRoute');\n    this.indexesOfPointsAlongRoute = this.navParams.get('indexesOfPointsAlongRoute');\n  }\n\n\n  dismiss(){\n    this.viewCtrl.dismiss();\n  }\n\n  setCrew(){\n\n    if(this.startHour === undefined){\n      let alert = this.alertCtrl.create({\n        title: 'Por favor confirma la hora a la que iniciarÃ­a este viaje',\n        buttons: ['OK']\n      }); \n      alert.present();\n    }else{\n\n      //AQUI QUEDE\n      this.afDB.database.ref('/crewsTest/' + this.userId).push({\n        admin: this.admin,\n        startHour: this.startHour,\n        destination: {\n          name: this.destination,\n          coords: {\n            lat: this.latDest,\n            lng: this.lngDest\n          }\n        },\n        origin: {\n          name: this.origin,\n          coords: {\n            lat: this.latOr,\n            lng: this.lngOr\n          }\n        },\n      }).then((snap)=>{\n        const Key_Crew = snap.key;\n        this.afDB.database.ref('/crewsTest/' + this.userId + '/' + Key_Crew).update({\n          crewId: Key_Crew\n        }).then(()=>{\n\n                  this.geofireServicesDr.setGeofireOrCrew( Key_Crew, this.latOr, this.lngOr );\n                  this.afDB.database.ref('/geofireOrCrew/' + Key_Crew,).update({\n                    adminId: this.userId\n                  });\n\n                  console.log('executed geofire Or for crews');\n\n                this.geofireServicesDr.setGeofireDestCrew( Key_Crew, this.latDest, this.lngDest);\n                this.afDB.database.ref('/geofireDestCrew/' + Key_Crew).update({\n                  adminId: this.userId\n                });\n                \n                console.log('executed geofire dest');\n              \n              \n              this.indexesOfPointsAlongRoute.forEach(index=>{\n                  this.count++\n                  let newKey = Key_Crew.concat(this.count)\n\n                  \n                  \n                  this.geofireServicesDr.setGeofireRouteCrew(newKey, this.pointsAlongRoute[index].lat, this.pointsAlongRoute[index].lng );\n                  this.afDB.database.ref('/geofireRouteCrew/' + newKey).update({\n                    adminId: this.userId,\n                    crewId: Key_Crew\n                });\n                \n                \n              })  \n\n        })\n\n        \n      }).then(()=>{\n        let alert = this.alertCtrl.create({\n          title: 'Eres ahora administrador del crew que acabaste de crear',\n          subTitle: 'Ve a \"Mis Viajes\" y revisa el estado de tu crew',\n          buttons: ['OK']\n        }); \n        alert.present();\n        this.viewCtrl.dismiss();\n      })\n    }\n    \n  }\n\n \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/p-createcrew/createcrew.ts"],"sourceRoot":""}